<!DOCTYPE html>
<html lang="en">
<head>
  <title>Framed Page</title>
  <script src="//cdn.jsdelivr.net/g/jquery@1.11.0"></script>
  <script src="//cdn.jsdelivr.net/jquery.cookie/1.4.0/jquery.cookie.min.js"></script>
</head>
<body style="background-color: lightcoral;">
<h2>This is the framed site</h2>
<i>(http://vit-demos.appspot.com/framed.html)</i>
<h3>Where are my cookies?</h3>

<script>
  function receiveMessage(event)
{
//   console.log(event.source, event.source.location.ancestorOrigins[0], event)
  console.log('trebao je uci',event.source.location.ancestorOrigins.length && event.source.location.ancestorOrigins[0] !== 'http://localhost:3001')
  if(event.source.location.ancestorOrigins.length && event.source.location.ancestorOrigins[0] !== 'http://localhost:3001')
    return;
  else {
  console.log(event)
  var hasCookie = false;
  $.cookie('the_cookie', 'the_value',  { expires: 365, path: '/' }); // 1 year
  if ($.cookie('the_cookie'))
    hasCookie = true
  window.parent.postMessage(hasCookie, event.source.location.ancestorOrigins[0]);
  }
}
window.addEventListener("message", receiveMessage, false);
</script>
</body>
</html>
